{% extends 'Componetes/Base/base.html' %}
{% load static %}

{% block title %}HuMap - Feed{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'Pages/Feed/feed.css' %}" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
{% endblock %}

{% block content %}
<main class="area-feed-feed">

  <div class="feed-header">
    <button class="botao-voltar-feed" onclick="window.location.href='{% url 'core:home' %}'" title="Voltar">
      <img src="{% static 'assets/deslize-para-a-esquerda.png' %}" alt="Voltar" class="imagem-seta-azul">
    </button>
  </div>

  {% for d in denuncias %}
  <section class="post-feed" data-id="{{ d.id }}" data-comentarios='[
        {% for c in d.comentarios_list %}
            {"usuario": "{{ c.usuario.first_name|default:"Anônimo" }}", "texto": "{{ c.texto|escapejs }}"}{% if not forloop.last %},{% endif %}
        {% endfor %}
    ]'>

    <div class="post-cabecalho-feed">
      <div class="post-avatar-feed" style="background-image: url('{% if d.usuario.foto %}{{ d.usuario.foto.url }}{% else %}{% static 'assets/perf.jpg' %}{% endif %}');"></div>
      <span class="post-usuario-feed">
        {{ d.usuario.first_name|default:"Usuário Anônimo" }}
      </span>
    </div>

    {% if d.anexos.first %}
    <div class="post-imagem-feed">
      <img src="{{ d.anexos.first.arquivo.url }}" alt="Foto da denúncia">
    </div>
    {% endif %}

    <p class="post-texto-feed">{{ d.descricao }}</p>

    <div class="post-acoes-feed">

      <!-- CURTIR -->
      <div class="acao-feed">
        <i class="fa-heart like-btn-feed 
                    {% if d.usuario_curtiu %}fa-solid{% else %}fa-regular{% endif %}" title="Curtir" style="color: {% if d.usuario_curtiu %}red{% else %}black{% endif %};">
        </i>
        <span class="curtidas-contador-feed like-count-feed">{{ d.curtidas_count|default:0 }}</span>
      </div>

      <!-- COMENTAR -->
      <div class="acao-feed">
        <i class="fa-regular fa-comment comment-btn-feed" title="Comentar"></i>
        <span class="comentarios-contador-feed comment-count-feed">{{ d.comentarios_list|length }}</span>
      </div>

      <!-- COPIAR LINK -->
      <div class="acao-feed">
        <i class="fa-solid fa-link link-btn-feed" title="Copiar Link"></i>
      </div>

      <!-- FAVORITAR -->
      <div class="acao-feed">
        <i class="fa-regular fa-star fav-btn-feed" title="Favoritar"></i>
      </div>

      <!-- DENUNCIAR -->
      <div class="acao-feed">
        <i class="fa-solid fa-triangle-exclamation report-btn-feed" title="Denunciar"></i>
      </div>

    </div>

    <!-- ÁREA DE COMENTÁRIOS -->
    <div class="area-comentarios-feed">
      <div class="lista-comentarios-feed comment-list-feed"></div>

      <div class="caixa-comentario-feed">
        <input type="text" class="comentario-input-feed comment-input-feed" placeholder="Escreva um comentário..." />
        <button type="button" class="botao-enviar-comentario-feed send-comment-feed">Enviar</button>
      </div>
    </div>

  </section>
  {% empty %}
  <p style="text-align:center; margin-top:20px;">Nenhuma denúncia encontrada.</p>
  {% endfor %}

</main>

<!-- MODAL DE REPORTAR -->
<div class="modal-overlay-feed">
  <div class="modal-box-feed">
    <h3>Reportar Problema</h3>
    <textarea class="modal-textarea-feed"></textarea>
    <div class="modal-actions-feed">
      <button class="modal-btn-feed cancel-feed">Cancelar</button>
      <button class="modal-btn-feed ok-feed">Enviar</button>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  const requestUserName = "{{ request.user.first_name|default:'Você' }}";
</script>
<script src="{% static 'Pages/Feed/feed.js' %}"></script>
{% endblock %}